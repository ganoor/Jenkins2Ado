<?xml version='1.1' encoding='UTF-8'?><flow-definition plugin="workflow-job@1145.v7f2433caa07f">  <actions>    <org.jenkinsci.plugins.pipeline.modeldefinition.actions.DeclarativeJobAction plugin="pipeline-model-definition@1.7.1"/>    <org.jenkinsci.plugins.pipeline.modeldefinition.actions.DeclarativeJobPropertyTrackerAction plugin="pipeline-model-definition@1.7.1">      <jobProperties>        <string>jenkins.model.BuildDiscarderProperty</string>      </jobProperties>      <triggers/>      <parameters>        <string>build_app_image</string>        <string>service_pack_location</string>        <string>Latest_dmap_image_version</string>        <string>Storage_Location</string>        <string>Build_Image</string>        <string>S3_Bucket</string>        <string>Blob_Storage</string>        <string>Build_Type</string>        <string>Service_pack_version</string>        <string>Java_Backend</string>        <string>Flask_Backend_branch</string>        <string>Change_in_binary_for</string>        <string>Minimum_dmap_image_version</string>        <string>sonarSeverities</string>        <string>Container_Name</string>        <string>docker_branch</string>        <string>sonarTypes</string>        <string>docker_image_version</string>        <string>docker_image</string>      </parameters>      <options/>    </org.jenkinsci.plugins.pipeline.modeldefinition.actions.DeclarativeJobPropertyTrackerAction>  </actions>  <description>Job to Build the image and binary. push binary into docker hub and push the image into Azure registry.</description>  <keepDependencies>false</keepDependencies>  <properties>    <jenkins.model.BuildDiscarderProperty>      <strategy class="hudson.tasks.LogRotator">        <daysToKeep>-1</daysToKeep>        <numToKeep>10</numToKeep>        <artifactDaysToKeep>-1</artifactDaysToKeep>        <artifactNumToKeep>-1</artifactNumToKeep>      </strategy>    </jenkins.model.BuildDiscarderProperty>    <hudson.model.ParametersDefinitionProperty>      <parameterDefinitions>        <hudson.model.StringParameterDefinition>          <name>Java_Backend</name>          <description>Enter the name of the Java Backend branch</description>          <defaultValue>develop</defaultValue>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>Flask_Backend_branch</name>          <description>Enter the name of the Backend branch</description>          <defaultValue>develop</defaultValue>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>Container_Name</name>          <description>Enter the name of the container in lower case, backup: you can put your name</description>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>Build_Image</name>          <description>Enter the name of the docker build image which will be used to build binaries</description>          <defaultValue>ngdmapo/app_build:v1</defaultValue>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>Service_pack_version</name>          <description>Enter the version of Service pack. Sample values will be like: 6.3.2.0</description>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>Latest_dmap_image_version</name>          <description>Enter the latest version of DMAP image. Sample values be like:7.4.2.1</description>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>Minimum_dmap_image_version</name>          <description>Enter the Minimum version of DMAP DB image to run current binaries. Sample values be like:7.4.2.1</description>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.ChoiceParameterDefinition>          <name>Change_in_binary_for</name>          <description>Select App or DB if there is binary change in App or DB respectively, select Both if there is binary change in Both (App and DB)</description>          <choices class="java.util.Arrays$ArrayList">            <a class="string-array">              <string>App</string>              <string>DB</string>              <string>Both</string>            </a>          </choices>        </hudson.model.ChoiceParameterDefinition>        <hudson.model.ChoiceParameterDefinition>          <name>Storage_Location</name>          <description>Enter the storage location to store Service pack which is either in S3 or BLOB</description>          <choices class="java.util.Arrays$ArrayList">            <a class="string-array">              <string>Azure_Blob</string>            </a>          </choices>        </hudson.model.ChoiceParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>Blob_Storage</name>          <description>Enter the Blob storage path for uploading the binaries. Sample values will be like dev: dmapextndevreleases, qa: dmapextnqareleases, prod: dmapextnreleases</description>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>sonarTypes</name>          <description>Enter the sonarQube issue types to certify the build</description>          <defaultValue>VULNERABILITY,BUG,CODE_SMELL</defaultValue>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>sonarSeverities</name>          <description>Enter the sonarQube issue severities to certify the build</description>          <defaultValue>CRITICAL,BLOCKER,MAJOR</defaultValue>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>VM_URL_for_binary_download</name>          <description>Enter the On Prem VM URL to download binaries from</description>          <defaultValue>http://192.168.3.183/app</defaultValue>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>OnPrem_Path</name>          <description>On Prem Path to copy the file Dev:dev QA:qa</description>          <defaultValue>dev</defaultValue>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>Fallback_Blob_URL_for_binary_download</name>          <description>Enter the fallback blob VM URL to download binaries from</description>          <defaultValue>https://msmkdmapdisks.blob.core.windows.net</defaultValue>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.ChoiceParameterDefinition>          <name>Build_Type</name>          <description>Select build type</description>          <choices class="java.util.Arrays$ArrayList">            <a class="string-array">              <string>Dev</string>              <string>QA</string>              <string>Prod</string>            </a>          </choices>        </hudson.model.ChoiceParameterDefinition>        <hudson.model.ChoiceParameterDefinition>          <name>build_app_image</name>          <description>Select Yes if you want to build the App Image or else select No</description>          <choices class="java.util.Arrays$ArrayList">            <a class="string-array">              <string>No</string>              <string>Yes</string>            </a>          </choices>        </hudson.model.ChoiceParameterDefinition>        <hudson.model.ChoiceParameterDefinition>          <name>docker_image</name>          <description>Select Docker Image name</description>          <choices class="java.util.Arrays$ArrayList">            <a class="string-array">              <string>dmap_app_migration_azure_blob_dev</string>              <string>dmap_app_migration_azure_blob_qa</string>              <string>dmap_app_migration_azure_blob_prod</string>              <string>dmap_aws_s3_prod</string>              <string>dmap_aws_s3_dev</string>              <string>dmap_aws_s3_qa</string>              <string>dmap_app_binary_update</string>            </a>          </choices>        </hudson.model.ChoiceParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>docker_branch</name>          <description>Enter git branch to pull docker files</description>          <defaultValue>develop</defaultValue>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>docker_image_version</name>          <description>Enter the Docker Image version</description>          <defaultValue>v1.0.0.0</defaultValue>          <trim>false</trim>        </hudson.model.StringParameterDefinition>        <hudson.model.StringParameterDefinition>          <name>service_pack_location</name>          <description>Enter service pack location (S3/BLOB). It should be full path</description>          <trim>false</trim>        </hudson.model.StringParameterDefinition>      </parameterDefinitions>    </hudson.model.ParametersDefinitionProperty>  </properties>  <definition class="org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition" plugin="workflow-cps@2.82">    <script>pipeline {    //agent any     agent {        node {            label &apos;build_slave&apos;        }    }    environment {		BUILD_NAME = &quot;DMAP App Binary Build&quot;		//NOTIFYUSERS = &apos;rajivm@newtglobalcorp.com&apos;		NOTIFYUSERS = &apos;dmap_dev@newtglobalcorp.com&apos;		BUILD_DETAILS = &quot;&lt;BR&gt;Job Name: ${env.JOB_NAME} &lt;BR&gt;Build Number: ${env.BUILD_NUMBER} &lt;BR&gt;Build URL: ${BUILD_URL}&quot;	}    parameters {        string(name: &apos;Java_Backend&apos;, defaultValue: &apos;develop&apos;, description: &apos;Enter the name of the Java Backend branch&apos;)        string(name: &apos;Flask_Backend_branch&apos;, defaultValue: &apos;develop&apos;, description: &apos;Enter the name of the Backend branch&apos;)	    string(name: &apos;Container_Name&apos;, defaultValue: &apos;&apos;, description: &apos;Enter the name of the container in lower case, backup: you can put your name&apos;)        string(name: &apos;Build_Image&apos;, defaultValue: &apos;ngdmapo/app_build:v1&apos;, description: &apos;Enter the name of the docker build image which will be used to build binaries&apos;)        string(name: &apos;Service_pack_version&apos;, defaultValue: &apos;&apos;, description: &apos;Enter the version of Service pack. Sample values will be like: 6.3.2.0&apos;)        string(name: &apos;Latest_dmap_image_version&apos;, defaultValue: &apos;&apos;, description: &apos;Enter the latest version of DMAP image. Sample values be like:7.4.2.1&apos;)        string(name: &apos;Minimum_dmap_image_version&apos;, defaultValue: &apos;&apos;, description: &apos;Enter the Minimum version of DMAP DB image to run current binaries. Sample values be like:7.4.2.1&apos;)        choice(name: &apos;Change_in_binary_for&apos;, choices: [&apos;App&apos;, &apos;DB&apos;,&apos;Both&apos;], description: &apos;Select App or DB if there is binary change in App or DB respectively, select Both if there is binary change in Both (App and DB)&apos;)        choice(name: &apos;Storage_Location&apos;, choices: [&apos;Azure_Blob&apos;], description: &apos;Enter the storage location to store Service pack which is BLOB&apos;)		string(name: &apos;VM_URL_for_binary_download&apos;, defaultValue: &apos;http://192.168.3.183/app&apos;, description: &apos;Enter the On Prem VM URL to download binaries from&apos;)		string(name: &apos;OnPrem_Path&apos;, defaultValue: &apos;dev&apos;, description: &apos;On Prem Path to copy the file Dev:dev QA:qa&apos;)		string(name: &apos;Fallback_Blob_URL_for_binary_download&apos;, defaultValue: &apos;https://msmkdmapdisks.blob.core.windows.net&apos;, description: &apos;Enter the fallback blob URL to download binaries from&apos;)		string(name: &apos;Blob_Storage&apos;, defaultValue: &apos;&apos;, description: &apos;Enter the Blob storage path for uploading the binaries. Sample values will be like dev: dmapextndevreleases, qa: dmapextnqareleases, prod: dmapextnreleases&apos;)        string(name: &apos;sonarTypes&apos;, defaultValue: &apos;VULNERABILITY,BUG,CODE_SMELL&apos;, description: &apos;Enter the sonarQube issue types to certify the build&apos;)        string(name: &apos;sonarSeverities&apos;, defaultValue: &apos;CRITICAL,BLOCKER,MAJOR&apos;, description: &apos;Enter the sonarQube issue severities to certify the build&apos;)        choice(name: &apos;Build_Type&apos;, choices: [&apos;Dev&apos;, &apos;QA&apos;, &apos;Prod&apos;], description: &apos;Select build type&apos;)        choice(name: &apos;build_app_image&apos;, choices: [&apos;No&apos;, &apos;Yes&apos;], description: &apos;Select Yes if you want to build the App Image or else select No&apos;)        choice(name: &apos;docker_image&apos;, choices: [&apos;dmap_app_migration_azure_blob_dev&apos;,&apos;dmap_app_migration_azure_blob_qa&apos;,&apos;dmap_app_migration_azure_blob_prod&apos;,&apos;dmap_aws_s3_prod&apos;,&apos;dmap_aws_s3_dev&apos;, &apos;dmap_aws_s3_qa&apos;,&apos;dmap_app_binary_update&apos;], description: &apos;Select Docker Image name&apos;)	    string(name: &apos;docker_branch&apos;, defaultValue: &apos;develop&apos;, description: &apos;Enter git branch to pull docker files&apos;)        string(name: &apos;docker_image_version&apos;, defaultValue: &apos;v1.0.0.0&apos;, description: &apos;Enter the Docker Image version&apos;)        string(name: &apos;service_pack_location&apos;, defaultValue: &apos;&apos;, description: &apos;Enter service pack location (S3/BLOB). It should be full path&apos;)        }    options {        timestamps()        timeout(time: 5, unit: &apos;HOURS&apos;)        buildDiscarder(logRotator(numToKeepStr: &apos;10&apos;))    }    stages {        stage (&quot;Checkout Code &quot;) {			steps {			    			    dir(&quot;DMAP_Extension_Backend&quot;){			        deleteDir()					echo &quot;Checkout the DMAP_Extension code&quot;					git branch: Java_Backend, credentialsId: &apos;Kavya_1709&apos;, url: &apos;https://github.com/newtglobalgit/DMAP_Extension-Backend.git&apos;			            }			    dir(&quot;DMAP_Extension_flask&quot;){			        deleteDir()                    echo &quot;Checkout the DMAP_Extension_Flask code&quot;                    script {                        withCredentials([usernamePassword(credentialsId: &apos;Kavya_1709&apos;, usernameVariable: &apos;GIT_USERNAME&apos;, passwordVariable: &apos;GIT_PASSWORD&apos;)]) {                        git url: &quot;https://${GIT_USERNAME}:${GIT_PASSWORD}@github.com/newtglobalgit/DMAP_Extension-Flask.git&quot;, branch: Flask_Backend_branch                            }                    }			     }                dir(&quot;DMAP_App_Docker&quot;){			        deleteDir()					echo &quot;Checkout the DMAP_DB_Dockerfile&quot;					git branch: docker_branch, credentialsId: &apos;Kavya_1709&apos;, url: &apos;https://github.com/newtglobalgit/DMAP_Extension_Docker_Linux.git&apos;			        } 			      }        }			stage (&quot;Sonar Analysis&quot;) {			steps{			    echo &quot;Flask sonar Analysis&quot;			    			     dir(&quot;DMAP_Extension_flask&quot;){    		       sh &quot;sonar-scanner \    				-Dsonar.projectKey=DMAP_Extension-Flask \    				-Dsonar.projectName=DMAP_Extension-Flask \    				-Dsonar.sources=. \    				-Dsonar.host.url=http://192.168.2.106:9000/sonarqube\    				-Dsonar.login=25534cb4ff60d377ca72aefd244d70eff8bfcf56 \    				-Dsonar.exclusions=Tests/**,Spark/**,ModularityTesting/Spark/**&quot;    			                }                 echo &quot;Python sonar Analysis done&quot;			    				echo &quot;Java sonar Analysis&quot;							    dir(&quot;DMAP_Extension_Backend&quot;){                   sh &quot;mkdir /tmp/empty&quot;    		       sh &quot;sonar-scanner \    				-Dsonar.projectKey=DMAP-Extension-Backend \    				-Dsonar.projectName=DMAP-Extension-Backend \    				-Dsonar.language=java \    				-Dsonar.sources=src/main/java \    				-Dsonar.java.binaries=/tmp/empty \    				-Dsonar.host.url=http://192.168.2.106:9000/sonarqube\    				-Dsonar.login=25534cb4ff60d377ca72aefd244d70eff8bfcf56&quot;				   sh &quot;rm -r /tmp/empty&quot;                }			}     					    }		stage (&quot;Java Backend Tests&quot;){			steps{			    dir(&quot;DMAP_Extension_Backend&quot;){				    echo &quot;Started Snyk Tests&quot;				    				   sh &quot;chmod +x mvnw&quot;			         snykSecurity failOnIssues: false, snykInstallation: &apos;SnykV2PluginTest&apos;, snykTokenId: &apos;Snyk_API&apos;								    													//     //publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: false, reportDir: &apos;SonarQube&apos;, reportFiles: &apos;JavaSonarQualityGateCheck.html&apos;, reportName: //&apos;Java_Backend SonarQube Analysis Result&apos;, reportTitles: &apos;SonarQube Result&apos;])				     publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: false, reportDir: &apos;.&apos;, reportFiles: &apos;snyk_report.html&apos;, reportName: &apos;Snyk Result&apos;, reportTitles: &apos;Snyk Result&apos;])			     }			}		}		stage (&quot;Java Backend Build&quot;){			steps{			    withCredentials([string(credentialsId: &apos;GIT_User&apos;, variable: &apos;GITUser&apos;),string(credentialsId: &apos;Git_New_PAT&apos;, variable: &apos;Password&apos;)]) {                    sh &quot;docker run -d -it -e GIT_USER=${GITUser} -e GIT_PASS=${Password} -e GIT_BRANCH=${params.Java_Backend} --name=${params.Container_Name} ngdmapo/java_17:v2&quot;                }			    dir(&quot;DMAP_Extension_Backend&quot;){				    sh &quot;docker ps -a&quot;					sh &quot;docker cp BuildScript/make_backend.sh ${params.Container_Name}:/opt/app-root/src&quot;					echo &quot;------------Copied build scipt inside build container------------------&quot;					sh &quot;docker exec ${params.Container_Name} sh /opt/app-root/src/make_backend.sh&quot;					echo &quot;----------------------------Binaries created-------------------------------&quot;					sh &quot;docker cp ${params.Container_Name}:/opt/app-root/src/DMAP_Extension-Backend/target/DMAP.tar .&quot;					sh &quot;docker cp ${params.Container_Name}:/opt/app-root/src/DMAP_Extension-Backend/target/jacoco-report/index.html .&quot;					//sh &quot;docker cp ${params.Container_Name}:/opt/app-root/src/DMAP_Extension-Backend/target/site/surefire-report.html .&quot;					sh &quot;docker cp ${params.Container_Name}:/opt/app-root/src/DMAP_Extension-Backend/target/reports/surefire.html .&quot;									echo &quot;------------------------Copied binaries in Jenkins----------------------&quot;					sh &quot;mv index.html DMAP_App_Junit_CoverageReport.html&quot;					//sh &quot;mv surefire-report.html DMAP_App_Junit_PassFailReport.html&quot;					sh &quot;mv surefire.html DMAP_App_Junit_PassFailReport.html&quot;					sh &quot;cp DMAP.tar ../&quot;			     			      }			      	echo &quot;------------------Removing Build container ------------------&quot;					sh &quot;docker stop ${params.Container_Name}&quot;			    sh &quot;docker rm -f ${params.Container_Name}&quot;			}		}		stage (&quot;Flask Backend Test&quot;){			steps{			    dir(&quot;DMAP_Extension_flask&quot;){				    echo &quot;Running Bandit&quot;				    				   sh &quot;bandit -r ./ -x ./Deploy -ll -f html -o AppBanditAnalysisReport.html || true&quot;				    echo &quot;Running Sonar Analysis&quot;			        sh &quot;cd SonarQube; python TestSonar.py -I 192.168.2.106 -P 9000/sonarqube -T ${params.sonarTypes} -S ${params.sonarSeverities} | tee output.log&quot;										sh &quot;mv SonarQube/sonarAnalysis.html SonarQube/BackendFlaskSonarQualityGateCheck.html&quot;									publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: true, reportDir: &apos;.\\SonarQube&apos;, reportFiles: &apos;App_Python_Sonar_Issues.xlsx&apos;, reportName: &apos;App Python Sonar Excel Report&apos;, reportTitles: &apos;App Python Sonar Excel Report&apos;])				publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: true, reportDir: &apos;.\\SonarQube&apos;, reportFiles: &apos;App_Java_Sonar_Issues.xlsx&apos;, reportName: &apos;App java Sonar Excel Result&apos;, reportTitles: &apos;App Java Sonar Excel Result&apos;])            	publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: true, reportDir: &apos;.&apos;, reportFiles: &apos;AppBanditAnalysisReport.html&apos;, reportName: &apos;App Bandit Security Report&apos;, reportTitles: &apos;App Bandit Security Report&apos;])	     			      }			}		}		stage (&quot;Flask Backend Build&quot;){			steps{				    echo &quot;Create Binaries&quot;                   sh &quot;docker pull ngdmapo/app_build:v1&quot;                 sh &quot;docker run -it -d -p 5009:5002 -p 9099:8080 --name=${params.Container_Name} ngdmapo/app_build:v1&quot;				    echo &quot;---------------------Completed creating build container---------------------------&quot;                    dir(&quot;DMAP_Extension_flask&quot;){                    echo &quot;------------------Build container created-------------------------------&quot;					sh &quot;docker ps -a&quot;                    sh &quot;docker cp . ${params.Container_Name}:/usr/local/tomcat/DMAP_Extension-Flask&quot;					sh &quot;docker cp BuildScript/make_backend.sh ${params.Container_Name}:/usr/local/tomcat&quot;					echo &quot;------------Copied build scipt inside build container------------------&quot;					sh &quot;docker exec --user=root ${params.Container_Name} sh /usr/local/tomcat/make_backend.sh&quot;					echo &quot;----------------------------Binaries created-------------------------------&quot;					sh &quot;docker cp ${params.Container_Name}:/usr/local/tomcat/DMAP_Extension-Flask/dist/Service.tar .&quot;					echo &quot;------------------------Copied binaries in Jenkins----------------------&quot;					sh &quot;cp Service.tar ../&quot;			      }                echo &quot;------------------Removing Build container ------------------&quot;				sh &quot;docker stop ${params.Container_Name}&quot;			    sh &quot;docker rm -f ${params.Container_Name}&quot;			    echo &quot;------------------Build container removed successfully------------------&quot;			}		}		/*		stage (&quot;Modular Tests&quot;) {		    steps {				echo &quot;---------------------Creating App build container for modular test---------------------------&quot;				docker run -d -it -p 5433:5432 -p 9090:8080 -p 7002:5002 -e UI_PORT=9090 -e SERVICE_PORT=7002  -e DB_PORT=5433 --name=Run_Modular_Test ngdmapo/dmap_azure_blob_qa:v8.1.0.0				sh &quot;docker run -d -it  -p 5005:5000 -e UI_PORT=8085 -e SERVICE_PORT=5003 --name=run_modular_test_scripts_app ngdmapo/dmap_app_migration_azure_blob_dev:v1.1.0.1&quot;				echo &quot;------------------Wait 40 minutes to start backend-------------------------------&quot;				sleep 900				dir(&quot;DMAP_Extension_flask&quot;){					sh &quot;docker ps -a&quot;					sh &quot;docker cp run_modularTest.sh run_modular_test_scripts:/usr/local/tomcat&quot;					echo &quot;------------Copied modular test build script inside build container------------------&quot;					sh &quot;docker exec run_modular_test_scripts sh /usr/local/tomcat/run_modularTest.sh&quot;					sleep 600					echo &quot;------------Copying modular test cases reports------------------&quot;					sh &quot;docker cp run_modular_test_scripts:/usr/local/tomcat/DMAP_Extension_flask/ModularityTesting/ModularTestOutput.html .&quot;					sh &quot;docker cp run_modular_test_scripts:/usr/local/tomcat/DMAP_Extension_flask/htmlcov/index.html .&quot;					sh &quot;mv index.html ModularTestCoverageReport.html&quot;					echo &quot;------------Completed copying modular test cases reports------------------&quot;					echo &quot;------------Removing modular test container ------------------&quot;					sh &quot;docker stop run_modular_test_scripts&quot;					sh &quot;docker rm -f run_modular_test_scripts&quot;					sh &quot;docker stop Run_Modular_Test&quot;					sh &quot;docker rm -f Run_Modular_Test&quot;										echo &quot;------------Modular test container removed successfully------------------&quot;										publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: true, reportDir: &apos;.&apos;, reportFiles: &apos;ModularTestOutput.html&apos;, reportName: &apos;Modular Test Output&apos;, reportTitles: &apos;Modular Test Output&apos;])					publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: true, reportDir: &apos;.&apos;, reportFiles: &apos;ModularTestCoverageReport.html&apos;, reportName: &apos;Modular Test Coverage&apos;, reportTitles: &apos;Modular Test Coverage&apos;])				}			}		}        */        stage (&quot;Package Binary&quot;){			steps {			    echo &quot;------------------Package Binary------------------&quot;			    script {			      def now = new Date()			      def time = now.format(&quot;yyyy-MM-dd HH:mm:ss&quot;, TimeZone.getTimeZone(&apos;UTC&apos;))			      writeFile(file: &apos;dmap_release.yaml&apos;, text:&quot;product_name: DMAP\nbinary_version: ${params.Service_pack_version}\nminimal_supported_image_version: ${params.Minimum_dmap_image_version}\ndate_published: ${time}\nbuild_type: ${params.Build_Type}&quot;)			      sh &quot;tar cvf dmap_release.tar DMAP.tar Service.tar dmap_release.yaml&quot;			    }			}		}       stage (&quot;Blob Storage Upload&quot;){		    when {                expression { params.Storage_Location == &quot;Azure_Blob&quot; }            }			steps {				echo &quot;---------------Deploying Artifacts to Blob Storage--------------&quot;				script {				    echo &quot;Azure Blob Service Pack&quot;				    def now = new Date()			        def time = now.format(&quot;yyyy-MM-dd HH:mm:ss&quot;, TimeZone.getTimeZone(&apos;UTC&apos;))										sh &quot;echo \$(md5sum dmap_release.tar | cut -d &apos; &apos; -f1) &gt;&gt; dmap_tar_checksum.txt&quot;								        sh &quot;echo \$(stat -c \&quot;%n,%s\&quot; dmap_release.tar | column -s, | cut -d &apos;,&apos; -f2) &gt;&gt; dmap_tar_filesize.txt&quot;								        def md5sum = readFile(file: &apos;dmap_tar_checksum.txt&apos;)			        def filesize = readFile(file: &apos;dmap_tar_filesize.txt&apos;)										sh &quot;rm -rf dmap_tar_checksum.txt&quot;			        sh &quot;rm -rf dmap_tar_filesize.txt&quot;										sh &quot;echo latest_release_info&quot;			        writeFile(file: &apos;dmap_latest_release_info.yaml&apos;, text:&quot;product_name: DMAP\nlatest_image_version: ${params.Latest_dmap_image_version}\nlatest_binary_version: ${params.Service_pack_version}\nChange_in_binary_for : ${params.Change_in_binary_for}\nminimal_supported_image_version: ${params.Minimum_dmap_image_version}\ndate_published: ${time}\nchecksum: ${md5sum}filesize: ${filesize}url_to_download_dmap_binary: https://msmkdmapdisks.blob.core.windows.net/${params.Blob_Storage}/&quot;)				}							        withCredentials([string(credentialsId: &apos;BlobAccountKey&apos;, variable: &apos;BlobAccountKey&apos;)]) {                        sh &quot;az storage blob upload --account-name msmkdmapdisks --account-key ${BlobAccountKey} --container-name ${params.Blob_Storage} --file dmap_release.tar --name dmap_release.tar&quot;                        sh &quot;az storage blob upload --account-name msmkdmapdisks --account-key ${BlobAccountKey} --container-name ${params.Blob_Storage} --file dmap_latest_release_info.yaml --name dmap_latest_release_info.yaml&quot;			        }                			}		}		stage (&quot;On-Prem Upload&quot;){		    when {                expression { params.Build_Type == &quot;Dev&quot; || params.Build_Type == &quot;QA&quot; }            }			steps {				echo &quot;---------------Copying artifacts to file path--------------&quot;				sh &quot;cp dmap_release.tar /var/www/html/app/${params.OnPrem_Path}/&quot;				sh &quot;rm -rf dmap_latest_release_info.yaml&quot;								script{				    def now = new Date()			        def time = now.format(&quot;yyyy-MM-dd HH:mm:ss&quot;, TimeZone.getTimeZone(&apos;UTC&apos;))										sh &quot;echo \$(md5sum dmap_release.tar | cut -d &apos; &apos; -f1) &gt;&gt; dmap_tar_checksum.txt&quot;								        sh &quot;echo \$(stat -c \&quot;%n,%s\&quot; dmap_release.tar | column -s, | cut -d &apos;,&apos; -f2) &gt;&gt; dmap_tar_filesize.txt&quot;								        def md5sum = readFile(file: &apos;dmap_tar_checksum.txt&apos;)			        def filesize = readFile(file: &apos;dmap_tar_filesize.txt&apos;)										sh &quot;rm -rf dmap_tar_checksum.txt&quot;			        sh &quot;rm -rf dmap_tar_filesize.txt&quot;										sh &quot;echo latest_release_info&quot;        		    writeFile(file: &apos;dmap_latest_release_info.yaml&apos;, text:&quot;product_name: DMAP\nlatest_image_version: ${params.Latest_dmap_image_version}\nlatest_binary_version: ${params.Service_pack_version}\nChange_in_binary_for : ${params.Change_in_binary_for}\nminimal_supported_image_version: ${params.Minimum_dmap_image_version}\ndate_published: ${time}\nchecksum: ${md5sum}filesize: ${filesize}\nfallback_blob_url_to_download_dmap_binary: ${params.Fallback_Blob_URL_for_binary_download}/${params.Blob_Storage}\nurl_to_download_dmap_binary: ${params.VM_URL_for_binary_download}/${params.OnPrem_Path}/&quot;)    				        				sh &quot;cp dmap_latest_release_info.yaml /var/www/html/app/${params.OnPrem_Path}/&quot; 				}			}		}        	stage (&quot;Docker Build&quot;) {        	  when {                expression { params.build_app_image == &quot;Yes&quot; }                }    		steps {    		    dir(&quot;DMAP_App_Docker&quot;){    		    script {    		    writeFile(file: &apos;dmap_image_release.yaml&apos;, text:&quot;name: DMAP\nimage_version: ${params.docker_image_version}\ninitial_service_pack_version: ${params.Service_pack_version}\n&quot;)    		    //Added to Support - Allow user to Enable or Disable Auto Binary Update    		    writeFile(file: &apos;dmap_binary_install_mode.yaml&apos;, text:&quot;binary_install_mode: automatic\n&quot;)			    if(params.docker_image == &quot;dmap_aws_s3_dev&quot; || params.docker_image == &quot;dmap_aws_s3_qa&quot; || params.docker_image == &quot;dmap_aws_s3_prod&quot;){       			        echo &quot;Build AWS Docker Image&quot;    			                        sh &quot;&quot;&quot;                    sed -i -e &apos;s#service_pack_location#${params.service_pack_location}#&apos; docker_dmap_aws                    &quot;&quot;&quot;                        			    sh &quot;docker build -t ngdmapo/${params.docker_image}:${params.docker_image_version} -f docker_dmap_aws .&quot;    			    sh &quot;docker images&quot;			    }			    else if(params.docker_image == &quot;dmap_app_migration_azure_blob_prod&quot; || params.docker_image == &quot;dmap_app_migration_azure_blob_dev&quot; || params.docker_image == &quot;dmap_app_migration_azure_blob_qa&quot; || params.docker_image == &quot;dmap_app_binary_update&quot;){			        echo &quot;Docker Azure Blob&quot;			        writeFile(file: &apos;dmap_image_release.yaml&apos;, text:&quot;name: DMAP\nimage_version: ${params.docker_image_version}\ninitial_service_pack_version: ${params.Service_pack_version}\n&quot;)			        			        echo &quot;Build Azure Docker Image&quot;    			    sh &quot;&quot;&quot;                    sed -i -e &apos;s#service_pack_location#${params.service_pack_location}#&apos; Dockerfile                    &quot;&quot;&quot;                        			    sh &quot;docker build -t ngdmapo/${params.docker_image}:${params.docker_image_version} .&quot;    		    			 			    }			     sh &quot;docker images&quot;    		    }			    }    		}    		    	} 	    stage (&quot;Docker Push&quot;) {	        	when {                expression { params.build_app_image == &quot;Yes&quot; }            }    		steps {    		   script{    		        echo &quot;Push Docker Image&quot;     			    withCredentials([usernamePassword(credentialsId: &apos;DockerHubCred&apos;, passwordVariable: &apos;dockerHubPassword&apos;, usernameVariable: &apos;dockerHubUser&apos;)]) {                        sh &quot;docker login -u ${env.dockerHubUser} -p ${env.dockerHubPassword}&quot;    			    			        sh &quot;docker tag ngdmapo/${docker_image}:${docker_image_version} ngdmapo/${docker_image}&quot;    			        sh &quot;docker push ngdmapo/${docker_image}:${docker_image_version}&quot;    			        sh &quot;docker push ngdmapo/${docker_image}&quot;    			          			                            }    			        			    }    	    	    }	    }	    stage (&quot;Remove Docker Image&quot;) {	        	when {                expression { params.build_app_image == &quot;Yes&quot; }            }    		steps {    			    echo &quot;Remove Docker Image&quot;    			    //sh &quot;docker rmi ngdmapo/${params.docker_image}:${docker_image_version}&quot;    		}    		    	}     }    post {        always {            emailext attachmentsPattern: &apos;DMAP_Extension_flask/AppBanditAnalysisReport.html,DMAP_Extension_Backend/snyk_report.html,DMAP_Extension_Backend/DMAP_App_Junit_CoverageReport.html,DMAP_Extension_Backend/DMAP_App_Junit_PassFailReport.html,DMAP_Extension_flask/SonarQube/App_Python_Sonar_Issues.xlsx,DMAP_Extension_flask/SonarQube/App_Java_Sonar_Issues.xlsx,DMAP_Extension_flask/ModularTestCoverageReport.html,DMAP_Extension_flask/ModularTestOutput.html&apos;,            //emailext attachmentsPattern: &apos;DMAP_Extension_flask/AppBanditAnalysisReport.html,DMAP_Extension_Backend/snyk_report.html,DMAP_Extension_flask/SonarQube/App_Python_Sonar_Issues.xlsx,DMAP_Extension_flask/SonarQube/App_Java_Sonar_Issues.xlsx,DMAP_Extension_flask/ModularTestCoverageReport.html,DMAP_Extension_flask/ModularTestOutput.html&apos;,            subject: &quot;Jenkins Job Report For ${BUILD_NAME} - ${currentBuild.currentResult}&quot;,			body: &quot;BUILD DETAILS: ${BUILD_DETAILS} &lt;BR&gt; BUILD STATUS: ${currentBuild.currentResult}&quot;,			to: &quot;${NOTIFYUSERS}&quot;        }    }}</script>    <sandbox>true</sandbox>  </definition>  <triggers/>  <disabled>false</disabled></flow-definition>